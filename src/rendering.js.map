{"version":3,"sources":["../src/rendering.js"],"names":["link","scope","elem","attrs","ctrl","data","panel","find","$tooltip","$","events","on","render","setElementHeight","height","row","_","isString","parseInt","replace","title","css","e","formatter","label","slice","fontSize","color","Math","round","percent","addThermometer","width","size","min","minValue","max","maxValue","currentValue","value","colorGauge","getColor","textColor","colorValue","percentage","ballSize","floor","barWidth","borderWidth","boxShadowWidth","colorBarWidth","html","valueFormatted","incrementRenderCounter","renderingCompleted"],"mappings":"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","file":"rendering.js","sourcesContent":["import _ from 'lodash';\nimport $ from 'jquery';\nimport 'jquery.flot';\nimport 'jquery.flot.pie';\n\nexport default function link(scope, elem, attrs, ctrl) {\n  var data, panel;\n  elem = elem.find('.thermometer-panel');\n  var $tooltip = $('<div id=\"tooltip\">');\n\n  ctrl.events.on('render', function() {\n    render(false);\n  });\n\n  function setElementHeight() {\n    try {\n      let height = ctrl.height || panel.height || ctrl.row.height;\n      if (_.isString(height)) {\n        height = parseInt(height.replace('px', ''), 10);\n      }\n      height -= 5 + (panel.title ? 24 : 9);\n      elem.css('height', height + 'px');\n      return true;\n    } catch(e) {\n      return false;\n    }\n  }\n\n  function formatter(label, slice) {\n    return \"<div style='font-size:\" + ctrl.panel.fontSize + \";text-align:center;padding:2px;color:\" + slice.color + \";'>\" + label + \"<br/>\" + Math.round(slice.percent) + \"%</div>\";\n  }\n\n  function addThermometer() {\n    var width = elem.width();\n    var height = elem.height();\n\n    var size = Math.min(width, height);\n\n    const min = panel.minValue;\n    const max = panel.maxValue;\n    const currentValue = data.value;\n\n    const color = panel.colorGauge ? ctrl.getColor() : '#ff0000';\n    const textColor = panel.colorValue ? ctrl.getColor() : 'inherit';\n    \n    let percentage = (currentValue - min) / (max - min) * 100;\n    percentage = Math.min(percentage, 100);\n    percentage = Math.max(percentage, 0);\n\n    const ballSize = Math.max(Math.floor(height * 0.25), 20);\n    const barWidth = ballSize * 0.4;\n    const borderWidth = barWidth / 6;\n    const boxShadowWidth = barWidth / 6;\n    const colorBarWidth = barWidth - (borderWidth + boxShadowWidth) * 2;\n    const html = `\n<span style=\"\n  margin:10px auto;\n  width:${ballSize}px;\n  height:100%;\n  min-height:30px;\n  display:block;\n  position:relative;\n\">\n  <!-- ball -->\n  <span style=\"\n    width:${ballSize}px;\n    height:${ballSize}px;\n    display:block;\n    position:absolute;\n    top:calc(100% - ${ballSize}px);\n    background:${color};\n    border-radius:${ballSize}px;\n    border:${borderWidth}px solid #fff;\n    box-shadow:inset 0 0 0 ${boxShadowWidth}px #000;\n    \"></span>\n  <!-- bar -->\n  <span style=\"\n    width:${barWidth}px;\n    height:calc(100% - ${ballSize - borderWidth - boxShadowWidth / 3}px);\n    display:block;\n    background:#333;        \n    border-radius:${barWidth}px ${barWidth}px 0 0;\n    border:${borderWidth}px solid #fff;\n    border-bottom:none;\n    position:relative;\n    left:${ballSize / 2 - barWidth / 2}px;\n    box-shadow:inset 0 0 0 ${boxShadowWidth}px #000;\n  \"></span>\n  <!-- color bar bottom -->\n  <span style=\"\n    width:${colorBarWidth}px;\n    height:${ballSize / 2}px;\n    display:block;\n    position:absolute;\n    bottom:${ballSize / 2}px;\n    left:${ballSize / 2 - barWidth / 2 + boxShadowWidth + borderWidth}px;\n    background:${color};\n  \"></span>\n  <!-- color bar wrapper -->\n  <span style=\"\n    width:${colorBarWidth}px;\n    height:calc(100% - ${ballSize + 10}px);\n    display:block;\n    position:absolute;\n    bottom:${ballSize}px;\n    left:${ballSize / 2 - barWidth / 2 + boxShadowWidth + borderWidth}px;\n  \">\n    <span style=\"\n      width:${colorBarWidth}px;    \n      height:${percentage}%;\n      display:block;\n      position:absolute;\n      bottom:0;\n      left:0;\n      background:${color};\n    \"></span>\n  </span>\n  <span style=\"\n    position:absolute;\n    top:calc(50% - 1em);\n    left:${ballSize + 5}px;\n    width:5em;\n    font-size:${panel.fontSize};\n    font-weight:bold;\n    color:${textColor};\n    \">${data.valueFormatted}</span>\n</span> \n`;\n    elem.html(html);\n  }\n\n  function render(incrementRenderCounter) {\n    if (!ctrl.data) { return; }\n\n    data = ctrl.data;\n    panel = ctrl.panel;\n\n    if (setElementHeight()) {\n      addThermometer();\n    }\n    if (incrementRenderCounter) {\n      ctrl.renderingCompleted();\n    }\n  }\n}\n\n"]}